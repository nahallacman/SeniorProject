Sprint plan 5:

collect scan codes
collect single press
interpret single press
interpret key release
interpret command keys