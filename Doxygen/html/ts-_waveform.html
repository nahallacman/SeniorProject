<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>EthKitTCP: Tuning the CVD Waveform - Optimizing Performance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EthKitTCP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ts-_waveform.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tuning the CVD Waveform - Optimizing Performance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="mTouch"></a>
CVD Waveform Steps</h1>
<p><code>CVD :: Capacitive Voltage Divider</code><br />
 <code>DAC :: Digital-to-Analog Converter</code><br />
 <code>ADC :: Analog-to-Digital Converter</code><br />
 <code>T<sub>AD</sub> :: Time required for the ADC to complete one bit conversion.</code><br />
<br />
</p>
<ul>
<li>
Stage 1 (a) :: Pre-charge <ul>
<li>
The sensor is set to <b>output low</b>. </li>
<li>
Either: <ul>
<li>
The DAC is set to <b>V<sub>DD</sub></b> and the ADC mux is pointed to the DAC. </li>
<li>
Another analog channel is set as <b>output high</b> and the ADC mux is pointed to that channel. </li>
</ul>
</li>
<li>
(Delay, based on #CVD_CHOLD_CHARGE_DELAY) </li>
</ul>
<br />
<br />
 </li>
<li>
Stage 2 (a) :: Acquisition / Settling <ul>
<li>
The sensor is set to an <b>input</b>. </li>
<li>
The ADC mux is updated to point to the sensor. </li>
<li>
(Delay, based on #CVD_SETTLING_DELAY) </li>
</ul>
<br />
<br />
 </li>
<li>
Stage 3 (a) :: Sampling <ul>
<li>
The ADC's GO/nDONE bit is set. </li>
<li>
The ADC mux waits 1/2 T<sub>AD</sub> then disconnects from the sensor. </li>
<li>
(The mTouch framework automatically delays the necessary time for the mux to disconnect.) </li>
<li>
The sensor is set to an <b>output</b>. </li>
</ul>
</li>
</ul>
<p>The ADC conversion completes while math is being performed on the previous mTouch scan result. </p><ul>
<li>
Stage 1 (b) :: Pre-charge <ul>
<li>
The sensor is set to <b>output high</b>. </li>
<li>
Either: <ul>
<li>
The DAC (digital-to-analog converter) is set to <b>V<sub>SS</sub></b> and the ADC (analog-to-digital converter) mux is pointed to the DAC. </li>
<li>
Another analog channel is set as <b>output low</b> and the ADC mux is pointed to that channel. </li>
</ul>
</li>
<li>
(Delay, based on #CVD_CHOLD_CHARGE_DELAY) </li>
</ul>
<br />
<br />
 </li>
<li>
Stage 2 (b) :: Acquisition / Settling <ul>
<li>
The sensor is set to an <b>input</b>. </li>
<li>
The ADC mux is updated to point to the sensor. </li>
<li>
(Delay, based on #CVD_SETTLING_DELAY) </li>
</ul>
<br />
<br />
 </li>
<li>
Stage 3 (b) :: Sampling <ul>
<li>
The ADC's GO/nDONE bit is set. </li>
<li>
The ADC mux waits 1/2 T<sub>AD</sub> then disconnects from the sensor. </li>
<li>
(The mTouch framework automatically delays the necessary time for the mux to disconnect.) </li>
<li>
The sensor is set to an <b>output</b>. </li>
</ul>
</li>
</ul>
<p>The ADC conversion completes. When finished, the first scan is subtracted from the second. The second scan is offset by 1024 to make sure this subtract never goes negative.</p>
<h1><a class="anchor" id="mTouch"></a>
CVD Waveform Steps</h1>
<p>Below is a picture of what the CVD waveform should look like on a scope. Note that sensor lines are used both for scanning themselves and the other sensors. You may notice the sensor being pulled high and low during other sensor's scans.</p>
<div class="image">
<img src="cvdWaveform.jpg" alt="cvdWaveform.jpg"/>
</div>
<p>The mTouch framework provides the ability to tune the timing of CVD waveform for specific hardware designs. The amount of parasitic capacitance, the size of the sensor, the size of the sensor's series resistor, and V<sub>DD</sub> all play a role in determining the amount of time required to charge/discharge during each step of the scan.</p>
<div class="image">
<img src="cvdWaveformDelay.jpg" alt="cvdWaveformDelay.jpg"/>
<div class="caption">
CVD Waveform Delay Configuration Options</div></div>
<p> <br />
</p>
<ul>
<li><b>CVD_CHOLD_CHARGE_DELAY</b><br />
<br />
 This value determines the amount of time provided for charging the internal hold capacitor of the ADC. <br />
<br />
 If this value is <b>too small</b>: There will be noticable crosstalk between closely-indexed sensors that is not related to the hardware layout of the application.<br />
 If this value is <b>too large</b>: The mTouch ISR will take an unnecessarily long amount of time to execute.<br />
<br />
 <b>To correctly set this value:</b> <ol>
<li>
Set this value to 0, compile and program. </li>
<li>
Look at the raw values on the mTouch One-Way GUI or through a terminal program.<br />
 You can find the mTouch One-Way GUI in <code>Your MLA Directory/mTouchCapDemos/Utilities/PIC12F PIC16F Utilities/mTouch One-Way GUI</code> </li>
<li>
Produce the largest shift possible on the sensor with the highest amount of capacitance by pressing on it. ("Highest Capacitance" usually corresponds to the sensor with the highest unpressed raw value.) <ul>
<li>
Do you notice a strange crosstalk behavior on a different sensor? If no, leave this value to 0. If yes... </li>
</ul>
</li>
<li>
Increase the delay until the crosstalk behavior is eliminated. </li>
</ol>
<br />
 Once you've solved the crosstalk for the sensor with the highest amount of capacitance, the others will be fine as well and you have correctly tuned the Chold delay time.</li>
</ul>
<p><br />
</p>
<ul>
<li><b>CVD_SETTLING_DELAY</b><br />
<br />
 This value determines the amount of time provided for the external sensor and internal hold capacitor to charge-average their voltages.<br />
<br />
 If this value is <b>too small</b>: The sensors will not be as sensitive as they could be and your sensor's readings will be V<sub>DD</sub> dependant.<br />
 If this value is <b>too large</b>: The noise immunity of the system will not be as robust as it could be.<br />
<br />
 <b>To correctly set this value:</b> <ol>
<li>
Set this value to 0, compile and program. </li>
<li>
Look at the raw values on the mTouch One-Way GUI or through a terminal program while powering the system at the desired V<sub>DD</sub> level.<br />
 You can find the mTouch One-Way GUI in <code>Your MLA Directory/mTouchCapDemos/Utilities/PIC12F PIC16F Utilities/mTouch One-Way GUI</code> </li>
<li>
Adjust V<sub>DD</sub> by plus and minus 0.5V <ul>
<li>
Do you notice any change in the unpressed value as V<sub>DD</sub> is changing? If no, leave this value alone. If yes... </li>
</ul>
</li>
<li>
Increase the delay until the sensor's reading no longer changes as V<sub>DD</sub> changes. </li>
</ol>
<br />
 Once this has occurred, the settling time has been correctly tuned to provide the maximum amount of sensitivity while minimizing the framework's susceptibility to noise. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="optimizing.html">Optimizing Performance</a></li>
    <li class="footer">Generated on Thu May 7 2015 20:33:58 for EthKitTCP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
