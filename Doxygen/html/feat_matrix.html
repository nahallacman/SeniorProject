<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>EthKitTCP: Matrix Designs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EthKitTCP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('feat_matrix.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Matrix Designs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The mTouch Framework supports decoding of matrix'd sensors to simplify the user's design process. This method allows for a larger number of possible unique press locations by decoding the state of two sensors at once: the row and the column.</p>
<h1><a class="anchor" id="featMatrix-How"></a>
How It Works</h1>
<p>The mTouch Framework will scan all sensors as normal. When a new set of readings is available, the framework will first perform some logic to determine which row and which column is the most pressed of the matrix. If both a row and column are activated, the state machine for the sensors will begin debouncing the result. After the required number of repeated results, the matrix coordinate-output will be updated.</p>
<div class="image">
<img src="matrix.JPG" alt="matrix.JPG"/>
<div class="caption">
Sensors in a Matrix Configuration</div></div>
 <h1><a class="anchor" id="featMatrix-Config"></a>
Proximity Sensor Configuration</h1>
<ol>
<li>
Configure the matrix'd sensors to be scanned as normal sensors in the <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework. ">mTouch_config.h</a> file. We will be defining index ranges for the rows and columns, so when configuring the MTOUCH_SENSORx list, make sure to place the matrix sensors as a continuous group starting at 0 or place at the very end with no 'normal' sensors after it. Within the matrix list, the rows should be grouped together and the columns should be grouped together. <div class="fragment"><div class="line"><span class="comment">// Example sensor configuration for matrix</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR0              AN0     // Matrix Row0    </span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR1              AN1     // Matrix Row1</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR2              AN2     // Matrix Col0</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR3              AN3     // Matrix Col1</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR4              AN4     // Matrix Col2</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR5              AN5     // Normal mTouch Sensor</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR6              AN6     // Normal mTouch Sensor</span></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="comment">// Example sensor configuration for matrix</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR0              AN0     // Normal mTouch Sensor</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR1              AN1     // Normal mTouch Sensor</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR2              AN2     // Matrix Col0</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR3              AN3     // Matrix Col1</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR4              AN4     // Matrix Col2</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR5              AN5     // Matrix Row0</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR6              AN6     // Matrix Row1</span></div>
</div><!-- fragment --> </li>
<li>
At the bottom of <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework. ">mTouch_config.h</a> is the 'Decoding' section which contains the matrix configuration options. <ol type="a">
<li>
Uncomment #MTOUCH_MATRIX_ENABLED to enable matrix decoding. </li>
<li>
Define #MTOUCH_MATRIX_ROW_START and #MTOUCH_MATRIX_ROW_END to the MTOUCH_SENSORx index values for the row sensors. In the first example, above, the start would be '0' and the end would be '1'. In the second example, the start would be '5' and the end would be '6'. </li>
<li>
Define #MTOUCH_MATRIX_COLUMN_START and #MTOUCH_MATRIX_COLUMN_END to the MTOUCH_SENSORx index values for the column sensors. In the first example, above, the start would be '2' and the end would be '4'. In the second example, the start would be '2' and the end would be '4'. </li>
<li>
Define one MTOUCH_SENSORx_IS_PROX definition per enabled proximity sensor. The value of the definition must be its 'proximity index' value. The 'Proximity index' is used as the index to proximity variable arrays. In total, the indexes should start at 0 and end with MTOUCH_NUMBER_PROXIMITY - 1. The order is arbitrary. </li>
<li>
If desired, set the value of #MTOUCH_MOST_PRESSED_THRESHOLD to the number of counts that the most-pressed row or column must be greater than the second-most-pressed row/column to qualify it as the 'most pressed'. </li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="featMatrix-Ex"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ENABLED               // &lt;-- Matrix decoding is enabled</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ROW_START         0   // &lt;-- The sensor index of the first row</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ROW_END           1   // &lt;-- The sensor index of the last row</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_COLUMN_START      2   // &lt;-- The sensor index of the first column</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_COLUMN_END        4   // &lt;-- The sensor index of the last column</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MOST_PRESSED_THRESHOLD   10  // &lt;-- The most pressed column/row must be at least 10 counts</span></div>
<div class="line"><span class="preprocessor">                                            //     greater than the second-most-pressed column/row.</span></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ENABLED               // &lt;-- Matrix decoding is enabled</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ROW_START         2   // &lt;-- The sensor index of the first row</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_ROW_END           3   // &lt;-- The sensor index of the last row</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_COLUMN_START      4   // &lt;-- The sensor index of the first column</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MATRIX_COLUMN_END        6   // &lt;-- The sensor index of the last column</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_MOST_PRESSED_THRESHOLD   10  // &lt;-- The most pressed column/row must be at least 10 counts</span></div>
<div class="line"><span class="preprocessor">                                            //     greater than the second-most-pressed column/row.</span></div>
</div><!-- fragment --><h1><a class="anchor" id="featMatrix-Out"></a>
Matrix Output</h1>
<p>The mTouch Framework stores the column and row output coordinates in an 8-bit value to save on RAM requirements. To easily decode which row and column is pressed, use the mTouch_Matrix_getRow() and mTouch_Matrix_getColumn() API functions. They will return the row and column indexes, respectively.</p>
<p>Note: The index they will be returning is relative to the matrix rows and matrix columns - not on the MTOUCH_SENSORx index value. For example, in the two example MTOUCH_SENSORx configurations above, pressing on Row0's sensor will make mTouch_Matrix_getRow() return '0' - regardless of whether the row is defined as MTOUCH_SENSOR0 or MTOUCH_SENSOR5.</p>
<p>mTouch_Matrix_hasChanged() will return a '0' if there was no change in the matrix output value since the last decode. mTouch_Matrix_latchNewValue() will save the current value of the matrix for later comparison. mTouch_Matrix_isPressed() will return a '0' if there are no pressed nodes on the matrix.</p>
<h1><a class="anchor" id="featMatrix-API"></a>
Example Matrix API</h1>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (mTouch_Matrix_hasChanged())         <span class="comment">// If the matrix value has changed since last time</span></div>
<div class="line">{</div>
<div class="line">    mTouch_Matrix_latchNewValue();      <span class="comment">// Save the new value of the matrix</span></div>
<div class="line">    </div>
<div class="line">    LED1  = LED_OFF;                    <span class="comment">// Reset all matrix outputs</span></div>
<div class="line">    LED2  = LED_OFF;</div>
<div class="line">    LED3  = LED_OFF;</div>
<div class="line">    LED4  = LED_OFF;</div>
<div class="line">    LED5  = LED_OFF;</div>
<div class="line">    LED6  = LED_OFF;</div>
<div class="line">    LED7  = LED_OFF;</div>
<div class="line">    LED8  = LED_OFF;</div>
<div class="line">    LED9  = LED_OFF;</div>
<div class="line">    LED10 = LED_OFF;</div>
<div class="line">    LED11 = LED_OFF;</div>
<div class="line">    LED12 = LED_OFF;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (mTouch_Matrix_isPressed())          <span class="comment">// If the matrix is being pressed</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(mTouch_Matrix_getRow())      <span class="comment">// Find the row/column being pressed and output accordingly.</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> 0:                         </div>
<div class="line">            <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> 0: LED1  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 0)</span></div>
<div class="line">                <span class="keywordflow">case</span> 1: LED2  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 1)</span></div>
<div class="line">                <span class="keywordflow">case</span> 2: LED3  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 2)</span></div>
<div class="line">                <span class="keywordflow">case</span> 3: LED4  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (0, 3)</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 1:</div>
<div class="line">            <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> 0: LED5  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 0)</span></div>
<div class="line">                <span class="keywordflow">case</span> 1: LED6  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 1)</span></div>
<div class="line">                <span class="keywordflow">case</span> 2: LED7  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 2)</span></div>
<div class="line">                <span class="keywordflow">case</span> 3: LED8  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (1, 3)</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> 2:</div>
<div class="line">            <span class="keywordflow">switch</span>(mTouch_Matrix_getColumn())</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">case</span> 0: LED9  = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 0)</span></div>
<div class="line">                <span class="keywordflow">case</span> 1: LED10 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 1)</span></div>
<div class="line">                <span class="keywordflow">case</span> 2: LED11 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 2)</span></div>
<div class="line">                <span class="keywordflow">case</span> 3: LED12 = LED_ON; <span class="keywordflow">break</span>;  <span class="comment">// (2, 3)</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="_framework_features.html">Features</a></li>
    <li class="footer">Generated on Thu May 7 2015 20:33:58 for EthKitTCP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
