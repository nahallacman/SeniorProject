<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>EthKitTCP: Proximity Sensors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EthKitTCP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('feat_proximity.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Proximity Sensors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The mTouch Framework supports proximity detection sensors. Enabling this feature for a sensor will provide a higher signal-to-noise ratio by applying a median filter. Future updates may further enhance this capability. The API for handling the proximity sensor is exactly the same as with a normal sensor.</p>
<h1><a class="anchor" id="featProx-How"></a>
How It Works</h1>
<p>The theory of operation for proximity sensors is the same as touch buttons and keys. However, proximity sensors must be able to detect very small changes in capacitance, so a median filter is implemented to reduce the noise level. The largest cost of implementing this feature is the RAM requirement since we must store the previous N samples for the median filter. This also means the response time will be longer than for a normal sensor while the median filter updates.</p>
<p>The basic idea of a median filter is that it stores a history of the previous scan results in a first-in, first-out buffer. After each new scan, the oldest value is replaced with the newest, the array is sorted by size, and the middle values are averaged.</p>
<div class="image">
<img src="medianFilter.jpg" alt="medianFilter.jpg"/>
<div class="caption">
Median Filter Illustration</div></div>
 <h1><a class="anchor" id="featProx-Config"></a>
Proximity Sensor Configuration</h1>
<ol>
<li>
Configure the proximity sensor(s) to be scanned as normal sensors in the <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework. ">mTouch_config.h</a> file. The differences are that you may need to set a larger oversampling value and a lower threshold value to make the sensor more sensitive. The threshold, unlike for button sensors, should not be set by evaluating the maximum touch shift. Instead, set it by observing the maximum noise level. Using the two-way communications with the mTouch Two-Way GUI is an easy way to adjust these values.<br />
 You can find the mTouch Two-Way GUI in <code>Your MLA Directory/mTouchCapDemos/Utilities/PIC12F PIC16F Utilities/mTouch Two-Way GUI</code> </li>
<li>
At the bottom of <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework. ">mTouch_config.h</a> is the 'Proximity' configuration section. <ol type="a">
<li>
Set #MTOUCH_NUMBER_PROXIMITY to the total number of proximity sensors in your system. </li>
<li>
Define one MTOUCH_SENSORx_IS_PROX definition per enabled proximity sensor. The value of the definition must be its 'proximity index' value. The 'Proximity index' is used as the index to proximity variable arrays. In total, the indexes should start at 0 and end with MTOUCH_NUMBER_PROXIMITY - 1. The order is arbitrary. <div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_NUMBER_PROXIMITY     1          </span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR3_IS_PROX      0   // MTOUCH_SENSOR3 is a proximity sensor with index 0   </span></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_NUMBER_PROXIMITY     2          </span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR4_IS_PROX      0   // MTOUCH_SENSOR4 is a proximity sensor with index 0          </span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR9_IS_PROX      1   // MTOUCH_SENSOR9 is a proximity sensor with index 1</span></div>
</div><!-- fragment --> </li>
<li>
Set the parameters for the median filter: <ul>
<li>
#MTOUCH_PROX_BUFFER_SIZE decides the size of the buffer for the median filter. Each proximity sensor will have its own median filter array, so be careful when assigning this value as it will have significant effects on the RAM requirements of the proximity implementation. Valid options are 5, 9, and 15. Larger number means more filtering, but higher RAM requirements and slower response times. </li>
<li>
#MTOUCH_PROX_REMOVE_EXTREME determines how many of the largest and smallest numbers will be removed before averaging the middle values. For example, if we are filtering with a buffer size of 5 and this value is set to 1, we will average the 2nd, 3rd, and 4th values. With a buffer size of 9 and this value set to 2, we will average the 3rd, 4th, 5th, 6th, and 7th values. This value must be less than half the buffer size and greater than 0. </li>
<li>
Enable (recommended) or disable the #MTOUCH_PROX_USE_32BIT_ACCUM option based on your proximity sensor's output data. Enabling this will prevent math overflow errors when the buffer is being accumulated, but will add to the overall RAM requirement. It's possible you will not need this protection, depending on the configuration, so this has been provided to easily allow toggling between the two. (Example when you don't need the accumulator: buffer size of '5' and remove extreme value of '2'. No accumulation occurs: the middle value is taken as-is.) </li>
</ul>
</li>
</ol>
</li>
</ol>
<h1><a class="anchor" id="featProx-Ex"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_NUMBER_PROXIMITY       2   // Two proximity sensors</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR0_IS_PROX        0   // MTOUCH_SENSOR0 is a proximity sensor with index 0</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_SENSOR5_IS_PROX        1   // MTOUCH_SENSOR5 is a proximity sensor with index 1</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_PROX_BUFFER_SIZE       5   // Median filter stores the last 5 values of each proximity sensor</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_PROX_REMOVE_EXTREME    1   // Removes the largest and smallest values before averaging</span></div>
<div class="line"><span class="preprocessor">#define MTOUCH_PROX_USE_32BIT_ACCUM       // Uses a 32-bit accumulator to prevent math overflow</span></div>
</div><!-- fragment --><h1><a class="anchor" id="featProx-Out"></a>
Proximity Sensor Output</h1>
<p>The way to access proximity sensor states is the same as for a normal sensor - using mTouch_GetButtonState(i). The index, i, is the normal sensor index - not the proximity index. For example, in the above code we could check the state of the proximity sensors by using mTouch_GetButtonState(0) and mTouch_GetButtonState(5). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="_framework_features.html">Features</a></li>
    <li class="footer">Generated on Thu May 7 2015 20:33:58 for EthKitTCP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
