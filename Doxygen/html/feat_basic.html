<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>EthKitTCP: Basic mTouch Sensor Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EthKitTCP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('feat_basic.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Basic mTouch Sensor Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The mTouch Framework scans all sensors in the same basic manner. All sensors (whether normal 'button', part of a slider or wheel, a single row in a matrix, or a proximity sensor) start by being scanned using the mTouch CVD waveform. Once all enabled sensors have a 'final' reading, the data ready flag is set and the decoding routine is called from the main loop.</p>
<h1><a class="anchor" id="featBasic-Config"></a>
Basic mTouch Sensor Configuration</h1>
<ol>
<li>
In the <a class="el" href="m_touch__config_8h.html" title="Framework Configuration! Main configuration file for the mTouch Framework. ">mTouch_config.h</a> file, under 'System Setup' start by defining #_XTAL_FREQ to the frequency of your processor's oscillator in Hz. This does not set the value of your oscillator - it merely tells the framework what the value is initialized to by your application. </li>
<li>
Set #MTOUCH_INTEGRATION_TYPE to the behavior you desire for your application. <ul>
<li>
#MTOUCH_CONTROLS_ISR :: means the framework is the only interrupt in the application </li>
<li>
#MTOUCH_CALLED_FROM_ISR :: means the application will be calling <a class="el" href="group___acquisition.html#gaeeee5d5e14eaff7df78e9ad5d7ac9769" title="Implements the framework&#39;s active-mode acquisition routine. Sometimes implemented as an ISR...">mTouch_Scan()</a> from its own ISR. </li>
<li>
#MTOUCH_CALLED_FROM_MAINLOOP :: means the framework will perform scans any time the data-ready flag is checked. </li>
</ul>
</li>
<li>
Set #MTOUCH_SCAN_FUNCTIONALITY to the behavior you desire for your application. <ul>
<li>
#MTOUCH_SCANS_ONE_SENSOR :: means the framework only scans a single sensor per <a class="el" href="group___acquisition.html#gaeeee5d5e14eaff7df78e9ad5d7ac9769" title="Implements the framework&#39;s active-mode acquisition routine. Sometimes implemented as an ISR...">mTouch_Scan()</a> call. <ul>
<li>
This is the preferred value. It provides the best noise immunity due to increased jittering. </li>
</ul>
</li>
<li>
#MTOUCH_SCANS_ALL_SENSORS :: means the framework scans all sensors one time per <a class="el" href="group___acquisition.html#gaeeee5d5e14eaff7df78e9ad5d7ac9769" title="Implements the framework&#39;s active-mode acquisition routine. Sometimes implemented as an ISR...">mTouch_Scan()</a> call. <ul>
<li>
This can be chosen to increase the sampling rate of the system. Trade-off: slightly decreased noise robustness </li>
</ul>
</li>
</ul>
</li>
<li>
Under 'Sensor Setup', set #MTOUCH_NUMBER_SENSORS to the number of sensors to scan, in total. <dl class="section note"><dt>Note</dt><dd>Each sensor is usually a unique analog channel, but this is not required. To minimize the possibility of errors in the mTouch waveform, try not to repeat the same analog channel twice in a row. Also try and avoid having the first and last sensor as the same analog channel. </dd></dl>
</li>
<li>
For each sensor: <ol type="a">
<li>
Set MTOUCH_SENSORx to its corresponding analog channel. <div class="fragment"><div class="line"><span class="preprocessor">#define MTOUCH_SENSOR0                AN0     // Sensor0 is connected to AN4</span></div>
</div><!-- fragment --> </li>
<li>
Set THRESHOLD_PRESS_SENSORx to the threshold value for this sensor. <div class="fragment"><div class="line"><span class="preprocessor">#define THRESHOLD_PRESS_SENSOR0       100     // Reading must be 100 counts &gt; the baseline</span></div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>This value is difficult to determine prior to running the system on the hardware and examining the level of sensitivity. 100-500 is a good default value but may need to be drastically adjusted based on the specific hardware design. </dd></dl>
</li>
</ol>
</li>
<li>
Under 'Filtering', set #MTOUCH_SAMPLES_PER_SCAN to the amount of oversampling to perform on each sensor. </li>
<li>
Under 'Decoding', set #MTOUCH_BUTTON_TIMEOUT to the maximum number of consecutive 'pressed' state decisions in a row. After this counter is exceeded, the pressed sensor will be reset to unpressed. This creates a maximum press time and is an easy way to automatically recover from a stuck sensor. </li>
<li>
Set #MTOUCH_DEBOUNCE_PRESS and #MTOUCH_DEBOUNCE_RELEASE to the amount of debouncing to implement. </li>
</ol>
<h1><a class="anchor" id="featBasic-Out"></a>
Basic mTouch Sensor API</h1>
<p>First, we will need to set up the application to scan mTouch. To do this, we need to create a check in the main loop to service the mTouch decode function. If we are using mTouch as one of several ISRs, we also need to add the scanning call to our ISR logic.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="_graphics_2_g_d_d_2_default___template_2_main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    myApp_Init();                       <span class="comment">// Your application&#39;s initialization (examples provided in main.c)</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="m_touch_8c.html#ab73968cbb19d4ae25a65698c15906b65">mTouch_Init</a>();                      <span class="comment">// mTouch initialization</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #if defined(MCOMM_ENABLED)</span></div>
<div class="line">    <a class="code" href="m_comm_8c.html#ae411cd73970859fd79070afa9a1cb319">mComm_Init</a>();                       <span class="comment">// mComm initialization</span></div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"></div>
<div class="line">    INTCONbits.GIE = 1;                 <span class="comment">// Initialization complete. Begin servicing interrupts.</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (mTouch_isDataReady())       <span class="comment">// Is new information ready?</span></div>
<div class="line">        {</div>
<div class="line">            mTouch_Service();           <span class="comment">// Decode the newly captured data and transmit new data updates.</span></div>
<div class="line">            </div>
<div class="line">            <span class="comment">// Application sensor-state logic checks go here.</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> interrupt ISR(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    SAVE_STATE();                       <span class="comment">// mTouch Framework-supplied general ISR save state macro. </span></div>
<div class="line">                                        <span class="comment">// Not required, but convenient. </span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #if (MTOUCH_INTEGRATION_TYPE == MTOUCH_CALLED_FROM_ISR)</span></div>
<div class="line">        <span class="keywordflow">if</span> (mTouch_checkInterrupt())    <span class="comment">// Checks if the TMRxIE and TMRxIF flags are both equal to 1.</span></div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="group___acquisition.html#gaeeee5d5e14eaff7df78e9ad5d7ac9769">mTouch_Scan</a>();              <span class="comment">// Required if running as ISR slave. The mTouch timer interrupt </span></div>
<div class="line">                                        <span class="comment">// flag is cleared inside the mTouch_Scan() function.</span></div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">    #elif (MTOUCH_INTEGRATION_TYPE == MTOUCH_CALLED_FROM_MAINLOOP)</span></div>
<div class="line">        <a class="code" href="m_touch_8c.html#ab678fb469a6bdd3d0b75cc4b48adf504">mTouch_state</a>.<a class="code" href="structm_touch___state.html#a98199bfb33a755cb711b9119e571bd7d">isrServiced</a> = 1;   <span class="comment">// Alerts the mTouch scanning routine that an interrupt may </span></div>
<div class="line">                                        <span class="comment">// have disrupted a scan. This is cleared at the start of a</span></div>
<div class="line">                                        <span class="comment">// new scan and is checked at the end of the scan.</span></div>
<div class="line">                                        <span class="comment">// Bad data can affect the readings if this flag is not set.</span></div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    RESTORE_STATE();                    <span class="comment">// mTouch Framework-supplied general ISR restore state macro. </span></div>
<div class="line">                                        <span class="comment">// Not required, but convienent.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The API for accessing button states is mTouch_GetButtonState(i). The states have been enumerated with the labels: <a class="el" href="m_touch_cap_2_p_i_c12_f_01_p_i_c16_f_01_library_2m_touch_8h.html#a7d72b112c35bc51408030eb7ecdcacd2a8ac4e988fd74c22ff6e99ee854cc848f" title="Sensor is still initializing. ">MTOUCH_INITIALIZING</a>, <a class="el" href="m_touch_cap_2_p_i_c12_f_01_p_i_c16_f_01_library_2m_touch_8h.html#a7d72b112c35bc51408030eb7ecdcacd2a9171b63f68c2e5ed308f9700e824cbbe" title="Sensor is currently released. ">MTOUCH_RELEASED</a>, and <a class="el" href="m_touch_cap_2_p_i_c12_f_01_p_i_c16_f_01_library_2m_touch_8h.html#a7d72b112c35bc51408030eb7ecdcacd2aed5b3f2b7065991010f45eb04759ef01" title="Sensor is currently pressed. ">MTOUCH_PRESSED</a>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (mTouch_GetButtonState(0) &lt; <a class="code" href="m_touch_cap_2_p_i_c12_f_01_p_i_c16_f_01_library_2m_touch_8h.html#a7d72b112c35bc51408030eb7ecdcacd2aed5b3f2b7065991010f45eb04759ef01">MTOUCH_PRESSED</a>)</div>
<div class="line">{ </div>
<div class="line">    LED0 = LED_OFF;                     <span class="comment">// Sensor0 not pressed. Turn off LED.</span></div>
<div class="line">} <span class="keywordflow">else</span> { </div>
<div class="line">    LED0 = LED_ON;                      <span class="comment">// Sensor0 pressed. Turn on LED.</span></div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="_framework_features.html">Features</a></li>
    <li class="footer">Generated on Thu May 7 2015 20:33:58 for EthKitTCP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
